<?xml version="1.0"?>

<!-- 
	Cititruck driver with corresponding topic remappings.
-->

<launch>
	<arg name="robot_id" default="1"/>

    <arg name="sim" default="true"/>

    <arg name="xacro_name" default="iliad_uol_cititruck"/>        
    <arg name="asus" default="false" />
    <arg name="velodyne" default="false" />
    <arg name="kinect2" default="false"/>

    <arg name="controller" default="true"/>

    <!-- Used for manual calibration of sensor joints -->
    <arg name="calibration_gui" default="false"/>
    
    <!-- derived args -->
    <arg name="tf_prefix" value="robot$(arg robot_id)"/>
    <arg name="robot_name" value="$(arg tf_prefix)" /> 

    <arg name="sim_suffix" value="" unless="$(arg sim)"/>
    <arg name="sim_suffix" value="_sim" if="$(arg sim)"/>

    <arg name="calib_file" value="$(find iliad_launch_system)/config/calibration/$(arg robot_name)$(arg sim_suffix).yaml"/>

    <!-- Publish URDF description. --> 
    <include file="$(find iliad_launch_system)/launch/robots/cititruck/cititruck_description.launch">
        <arg name="robot_id" value="$(arg robot_id)"/>        
        <arg name="xacro_name" value="$(arg xacro_name)"/>
        <arg name="asus" value="$(arg asus)" />
        <arg name="velodyne" value="$(arg velodyne)" />
        <arg name="kinect2" value="$(arg kinect2)"/>

        <arg name="calibration_gui" value="$(arg calibration_gui)"/>
        <arg name="calib_file" value="$(arg calib_file)"/>
    </include>

    <!-- Load specific CitiTruck params -->
    <rosparam command="load" file="$(find iliad_launch_system)/config/robots/cititruck$(arg sim_suffix).yaml" ns="$(arg tf_prefix)" subst_value="true"/>

    <group ns="$(arg tf_prefix)">
        <!-- Publish joint positions (also used for calibration) -->
        <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
          <param name="use_gui" value="$(arg calibration_gui)"/>
          <param name="rate" value="100"/>
          <rosparam command="load" file="$(arg calib_file)"/> <!-- Load zero positions -->
        </node>

        <!-- Publish TF from static URDF and joints -->
        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher">
          <param name="tf_prefix" value="$(arg robot_name)"/>
        </node>

    </group>

    <!-- Overcomes gazebo plugin limitations -->
    <include file="$(find iliad_launch_system)/launch/robots/kinect2_simulation.launch" if="$(arg kinect2)">
        <arg name="robot_id" value="$(arg robot_id)"/>        
        <arg name="sim" value="$(arg sim)"/>        
    </include>


</launch>
